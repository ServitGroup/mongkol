<?php 
require_once 'c:\php_vendor\vendor\autoload.php';
define('DB_NAME', 'lcrm');
define('DB_USER', 'root');
define('DB_PASSWORD', '');
define('DB_HOST', '127.0.0.1');
define('DB_CHARSET', 'utf8');
define('DB_COLLATE', '');

use Illuminate\Database\Capsule\Manager as Capsule;
use Illuminate\Database\Eloquent\Model as Model;
use Carbon\Carbon;

$capsule = new Capsule;
$config = [
        'driver' => 'mysql',
        'host' => DB_HOST,
        'database' => DB_NAME,
        'username' => DB_USER,
        'password' => DB_PASSWORD,
        'charset' => 'utf8',
        'collation' => 'utf8_unicode_ci',
        'prefix' => '',
];

$capsule->addConnection($config, 'default');

// Set the event dispatcher used by Eloquent models... (optional)
use Illuminate\Events\Dispatcher;
use Illuminate\Container\Container;

$capsule->setEventDispatcher(new Dispatcher(new Container));

// // Make this Capsule instance available globally via static methods... (optional)
$capsule->setAsGlobal();

// // Setup the Eloquent ORM... (optional; unless you've used setEventDispatcher())
$capsule->bootEloquent();

class Menu extends Model
{
        protected $table = 'menus';
        protected $primaryKey = 'id';
        public $timestamps = true;


        public function parent()
        {
                return $this->hasOne('Menu', 'id', 'parent_id');
        }

        public function menuitems()
        {
                return $this->hasMany('Menu', 'parent_id');
        }

        public function tree()
        {
                return static::with(implode('.', array_fill(0, 10, 'menuitems')))->where('parent_id', '=', '0')->get();
        }
}

// $m = Menu::with('menuitems')->where('parent_id',0)->get();
// $m = Menu::tree();
// dump($m);
// exit();


class Paymentlog extends Model
{
        protected $table = 'paymentlogs';
        protected $primaryKey = 'id';
        public $timestamps = true;
}

class Column extends Model
{
        protected $table = 'columns';
        protected $primaryKey = 'id';
        public $timestamps = false;
}

// $columns = Column::where('table_id', 'paymentlogs')
// ->where('visible',1)
        // ->get();
// $paymentlogs = Paymentlog::get();
$phproutes = Menu::whereNotNull('permalink')->get();
echo '<script>var phproute = '.$phproutes.';</script>';
require_once __DIR__ . '/layout/head.php';
require_once __DIR__ . '/layout/header.php';
?>

<div class="wrapper row-offcanvas row-offcanvas-left" style="min-height: 600px;" id="app">
  <?php require_once __DIR__ . '/layout/navbar.php'; ?>
  <aside class="right-side right-padding">
   <div class="right-content" style="width:100%">
      <router-view></router-view>
   </div>
      <?php require_once __DIR__ . '/layout/footer.php'; ?>
  </aside>
        <div id="overlay" ref="overlay"  v-bind:style="$store.getters.overlaystyle" >
                <div class="preloader">
                        <div class="timer"></div>
                </div>
        </div>
</div>
<?php require_once __DIR__ . '/layout/foot.php'; ?>